language: go

sudo: true

go:
  - 1.15.x

before_install:
  - curl -sfL https://install.goreleaser.com/github.com/goreleaser/goreleaser.sh | sh
  - sudo apt-get install autoconf automake autopoint build-essential pkgconf libtool libzip-dev libjpeg-dev git libavformat-dev libavcodec-dev libavutil-dev libswscale-dev libavdevice-dev libwebp-dev gettext libmicrohttpd-dev
  - git clone https://github.com/Motion-Project/motion.git motion-release
  - cd motion-release
  - git checkout release-4.3.1
  - autoreconf -fiv
  - ./configure
  - make
  - sudo make install
  - cd ..
  - rm -rf motion-release
  # - motion -h
  - motion -c motion/motion_test.conf

go_import_path: github.com/andreacioni/motionctrl

# Required from Goreleaser
deploy:
- provider: script
  skip_cleanup: true
  script: goreleaser
  on:
    tags: true
    condition: $TRAVIS_OS_NAME = linux